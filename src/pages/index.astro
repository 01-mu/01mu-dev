---
import BaseLayout from "../layouts/BaseLayout.astro";
import AuthorCard from "../components/AuthorCard.astro";
import { getAllTags, getVisiblePosts } from "../utils/posts";

const posts = await getVisiblePosts();
const tags = getAllTags(posts);
---

<BaseLayout description="Quiet notes for long-form thinking." mainClass="main--home">
  <div class="home-layout">
    <section class="home-content">
      <h1 class="page-title">Latest writing</h1>
      {posts.length === 0 ? (
        <p class="prose-meta">No published posts yet.</p>
      ) : (
        <ul class="post-list">
          {posts.map((post) => (
            <li>
              <a class="title" href={`/posts/${post.slug}`}>{post.data.title}</a>
              <div class="meta">
                {post.data.date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
                {post.data.tags.length > 0 && (
                  <span>
                    {" Â· "}
                    {post.data.tags.join(", ")}
                  </span>
                )}
              </div>
            </li>
          ))}
        </ul>
      )}
    </section>
    <aside class="home-sidebar">
      <AuthorCard />
      {tags.length > 0 && (
        <>
          <div class="sidebar-divider" aria-hidden="true"></div>
          <div class="tag-card">
            <p class="tag-card-title">Tags</p>
            <div class="tag-list">
              {tags.map(({ tag, count }) => (
                <a class="tag-pill" href={`/tags/${encodeURIComponent(tag)}`}>
                  {tag} ({count})
                </a>
              ))}
            </div>
          </div>
        </>
      )}
    </aside>
  </div>
</BaseLayout>

<style>
  .home-layout {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 82ch) 220px minmax(0, 1fr);
    gap: 2.5rem;
    align-items: start;
  }

  .home-content {
    min-width: 0;
    grid-column: 2;
    background: var(--bg-paper);
    padding: 2.5rem 2.75rem 3rem;
  }

  .home-sidebar {
    align-self: start;
    grid-column: 3;
  }

  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-list li {
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .post-list .title {
    display: block;
    font-size: 1.1rem;
    font-weight: 560;
  }

  .post-list .meta {
    color: var(--muted);
    font-size: 0.9rem;
  }

  .sidebar-divider {
    height: 1px;
    background: var(--border);
    margin: 1.5rem 0 1.25rem;
  }

  .tag-card {
    margin-top: 1.2rem;
    display: grid;
    gap: 0.5rem;
  }

  .tag-card-title {
    font-size: 0.8rem;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    color: var(--muted);
    margin: 0;
  }

  @media (max-width: 720px) {
    .home-layout {
      grid-template-columns: minmax(0, 1fr);
    }

    .home-sidebar {
      display: none;
    }

    .home-content {
      padding: 2rem 1.5rem 2.5rem;
    }
  }
</style>
