---
import BaseLayout from "../layouts/BaseLayout.astro";
import AuthorCard from "../components/AuthorCard.astro";
import { getAllTags, getVisiblePosts } from "../utils/posts";

const posts = await getVisiblePosts();
const tags = getAllTags(posts);
---

<BaseLayout description="Quiet notes for long-form thinking." mainClass="main--home">
  <div class="home-layout">
    <section class="home-content">
      <h1 class="page-title">Latest writing</h1>
      {posts.length === 0 ? (
        <p class="prose-meta">No published posts yet.</p>
      ) : (
        <ul class="post-list">
          {posts.map((post) => (
            <li>
              <a class="title" href={`/posts/${post.slug}`}>{post.data.title}</a>
              <div class="meta">
                {post.data.date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
                {post.data.tags.length > 0 && (
                  <span>
                    {" Â· "}
                    {post.data.tags.join(", ")}
                  </span>
                )}
              </div>
            </li>
          ))}
        </ul>
      )}
    </section>
    <aside class="home-sidebar">
      <AuthorCard />
      {tags.length > 0 && (
        <>
          <div class="sidebar-divider" aria-hidden="true"></div>
          <div class="tag-card">
            <p class="tag-card-title">Tags</p>
            <div class="tag-list">
              {tags.map(({ tag, count }) => (
                <a class="tag-pill" href={`/tags/${encodeURIComponent(tag)}`}>
                  {tag} ({count})
                </a>
              ))}
            </div>
          </div>
        </>
      )}
    </aside>
  </div>
</BaseLayout>
