---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllTags, getVisiblePosts } from "../../utils/posts";

export async function getStaticPaths() {
  const posts = await getVisiblePosts();
  const tags = getAllTags(posts);

  return tags.map(({ tag }) => ({ params: { tag } }));
}

const posts = await getVisiblePosts();
const { tag } = Astro.params;
const taggedPosts = posts.filter((post) => post.data.tags.includes(tag));
---

<BaseLayout title={`Tag: ${tag}`}>
  <h1 class="page-title">Tag: {tag}</h1>
  {taggedPosts.length === 0 ? (
    <p class="prose-meta">No posts for this tag yet.</p>
  ) : (
    <ul class="post-list">
      {taggedPosts.map((post) => (
        <li>
          <a class="title" href={`/posts/${post.slug}`}>{post.data.title}</a>
          <div class="meta">
            {post.data.date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "numeric",
            })}
          </div>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>
