---
import BaseLayout from "../../layouts/BaseLayout.astro";
import Sidebar from "../../components/Sidebar.astro";
import { getAllTags, getVisiblePosts } from "../../utils/posts";

export async function getStaticPaths() {
  const posts = await getVisiblePosts();
  const tags = getAllTags(posts);

  return tags.map(({ tag }) => ({ params: { tag } }));
}

const posts = await getVisiblePosts();
const { tag } = Astro.params;
const taggedPosts = posts.filter((post) => post.data.tags.includes(tag));
---

<BaseLayout title={`Tag: ${tag}`} mainClass="main--home">
  <div class="home-layout">
    <section class="home-content">
      <h1 class="page-title">Tag: {tag}</h1>
      {taggedPosts.length === 0 ? (
        <p class="prose-meta">No posts for this tag yet.</p>
      ) : (
        <ul class="post-list">
          {taggedPosts.map((post) => (
            <li>
              <a class="title" href={`/posts/${post.slug}`}>{post.data.title}</a>
              <div class="meta">
                {post.data.date.toLocaleDateString("en-US", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
              </div>
            </li>
          ))}
        </ul>
      )}
    </section>
    <Sidebar />
  </div>
</BaseLayout>

<style>
  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-list li {
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .post-list .title {
    display: block;
    font-size: 1.1rem;
    font-weight: 560;
  }

  .post-list .meta {
    color: var(--muted);
    font-size: 0.9rem;
  }

  .home-layout {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 82ch) 220px minmax(0, 1fr);
    gap: 2.5rem;
    align-items: start;
  }

  .home-content {
    min-width: 0;
    grid-column: 2;
    background: var(--bg-paper);
    padding: 2.5rem 2.75rem 2.6rem;
  }


  @media (max-width: 720px) {
    .home-layout {
      grid-template-columns: minmax(0, 1fr);
      display: flex;
      flex-direction: column;
    }

    .home-content {
      grid-column: auto;
      order: 1;
      padding: 2rem 1.5rem 2.25rem;
    }
  }
</style>
