---
import BaseLayout from "../../layouts/BaseLayout.astro";
import { getAllTags, getVisiblePosts } from "../../utils/posts";

export async function getStaticPaths() {
  const posts = await getVisiblePosts();
  const tags = getAllTags(posts);

  return tags.map(({ tag }) => ({ params: { tag } }));
}

const posts = await getVisiblePosts();
const { tag } = Astro.params;
const taggedPosts = posts.filter((post) => post.data.tags.includes(tag));
---

<BaseLayout title={`Tag: ${tag}`}>
  <h1 class="page-title">Tag: {tag}</h1>
  {taggedPosts.length === 0 ? (
    <p class="prose-meta">No posts for this tag yet.</p>
  ) : (
    <ul class="post-list">
      {taggedPosts.map((post) => (
        <li>
          <a class="title" href={`/posts/${post.slug}`}>{post.data.title}</a>
          <div class="meta">
            {post.data.date.toLocaleDateString("en-US", {
              year: "numeric",
              month: "short",
              day: "numeric",
            })}
          </div>
        </li>
      ))}
    </ul>
  )}
</BaseLayout>

<style>
  .post-list {
    list-style: none;
    padding: 0;
    margin: 0;
  }

  .post-list li {
    padding: 1.25rem 0;
    border-bottom: 1px solid var(--border);
  }

  .post-list .title {
    display: block;
    font-size: 1.1rem;
    font-weight: 560;
  }

  .post-list .meta {
    color: var(--muted);
    font-size: 0.9rem;
  }
</style>
